@using SocialPulse.Core.ViewModels

@model InitSocialProfilesViewModel

@{
    ViewData["Title"] = "Strona główna";
}

<h2 class="mb-2">Profile</h2>

<input type="hidden" id="sessionGuid" value="@Model.SessionGuid" />

<div id="profilesContainer" class="row">
    @foreach (var profile in Model.SocialProfiles)
    {
        @await Html.PartialAsync("_SocialProfileOverview", profile)
    }
</div>

@section Scripts {
    <script>
            $(document).ready(function () {
            var sessionGuid = $("#sessionGuid").val();
            var isLoading = false;
            var noMoreProfiles = false;

            $(window).on("scroll", function () {
                if (noMoreProfiles || isLoading) {
                    return;
                }

                if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
                    loadNextProfiles();
                }
            });

            function loadNextProfiles() {
                isLoading = true;

                $.ajax({
                  type: "GET",
                  url: "/Home/GetNextProfiles",
                  data: { sessionGuid: sessionGuid },
                  success: function (htmlResult) {
                    if (!htmlResult) {
                      // It's empty => probably no more profiles
                      console.log("No more profiles.");
                      return;
                    }

                    // 'htmlResult' is the direct HTML from the partial
                    $("#profilesContainer").append(htmlResult);
                  },
                  error: function (xhr, status, error) {
                    console.error("Error fetching next profiles:", error);
                  }
                });
            }

        });
    </script>
} 